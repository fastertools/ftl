{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "FtlConfig",
  "description": "Root configuration structure for ftl.toml",
  "type": "object",
  "required": [
    "project"
  ],
  "properties": {
    "component": {
      "description": "Component definitions",
      "default": {},
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ComponentConfig"
      }
    },
    "mcp": {
      "description": "MCP component configuration",
      "default": {
        "authorizer": "ghcr.io/fastertools/mcp-authorizer:0.0.13",
        "gateway": "ghcr.io/fastertools/mcp-gateway:0.0.11",
        "validate_arguments": false
      },
      "allOf": [
        {
          "$ref": "#/definitions/McpConfig"
        }
      ]
    },
    "oauth": {
      "description": "OAuth configuration (optional)",
      "default": null,
      "anyOf": [
        {
          "$ref": "#/definitions/OauthConfig"
        },
        {
          "type": "null"
        }
      ]
    },
    "project": {
      "description": "Project metadata",
      "allOf": [
        {
          "$ref": "#/definitions/ProjectConfig"
        }
      ]
    },
    "variables": {
      "description": "Application-level variables",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ApplicationVariable"
      }
    }
  },
  "definitions": {
    "ApplicationVariable": {
      "description": "Application-level variable configuration",
      "anyOf": [
        {
          "description": "Variable with a default value",
          "type": "object",
          "required": [
            "default"
          ],
          "properties": {
            "default": {
              "description": "The default value for the variable",
              "type": "string"
            }
          }
        },
        {
          "description": "Required variable that must be provided at runtime",
          "type": "object",
          "required": [
            "required"
          ],
          "properties": {
            "required": {
              "description": "Whether the variable is required (should always be true)",
              "type": "boolean"
            }
          }
        }
      ]
    },
    "BuildConfig": {
      "description": "Build configuration for a tool",
      "type": "object",
      "required": [
        "command"
      ],
      "properties": {
        "command": {
          "description": "Build command to execute",
          "type": "string"
        },
        "env": {
          "description": "Environment variables to set during build",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "watch": {
          "description": "Paths to watch for changes in development mode",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "BuildProfile": {
      "description": "A single build profile",
      "type": "object",
      "required": [
        "command"
      ],
      "properties": {
        "command": {
          "description": "Build command to execute",
          "type": "string"
        },
        "env": {
          "description": "Environment variables to set during build",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "watch": {
          "description": "Paths to watch for changes in development mode",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "BuildProfiles": {
      "description": "Build profiles for a component",
      "type": "object"
    },
    "ComponentConfig": {
      "description": "Component configuration",
      "type": "object",
      "properties": {
        "allowed_outbound_hosts": {
          "description": "Allowed outbound hosts for the component",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "build": {
          "description": "Build configuration (required for local components with `wasm`)",
          "anyOf": [
            {
              "$ref": "#/definitions/BuildConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "deploy": {
          "description": "Deployment configuration",
          "anyOf": [
            {
              "$ref": "#/definitions/DeployConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "path": {
          "description": "Path to component directory relative to project root Required for local components, ignored for registry components",
          "type": [
            "string",
            "null"
          ]
        },
        "profiles": {
          "description": "Build profiles (optional, for advanced multi-profile builds)",
          "anyOf": [
            {
              "$ref": "#/definitions/BuildProfiles"
            },
            {
              "type": "null"
            }
          ]
        },
        "repo": {
          "description": "Repository reference for pre-built component (e.g., \"ghcr.io/org/tool:latest\") Mutually exclusive with `wasm`",
          "type": [
            "string",
            "null"
          ]
        },
        "up": {
          "description": "Up configuration for development mode",
          "anyOf": [
            {
              "$ref": "#/definitions/UpConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "variables": {
          "description": "Variables to pass to the component at runtime",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "wasm": {
          "description": "Path to the WASM file produced by the build (for local components) Mutually exclusive with `repo`",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "DeployConfig": {
      "description": "Deployment configuration for a component",
      "type": "object",
      "required": [
        "profile"
      ],
      "properties": {
        "name": {
          "description": "Optional custom name suffix for the deployed component The full name will be {project-name}-{name}",
          "type": [
            "string",
            "null"
          ]
        },
        "profile": {
          "description": "Build profile to use for deployment (e.g., \"release\", \"production\")",
          "type": "string"
        }
      }
    },
    "McpConfig": {
      "description": "MCP component configuration",
      "type": "object",
      "properties": {
        "authorizer": {
          "description": "MCP authorizer component registry URI",
          "default": "ghcr.io/fastertools/mcp-authorizer:0.0.13",
          "type": "string"
        },
        "gateway": {
          "description": "MCP gateway component registry URI",
          "default": "ghcr.io/fastertools/mcp-gateway:0.0.11",
          "type": "string"
        },
        "validate_arguments": {
          "description": "Whether to validate tool call arguments",
          "default": false,
          "type": "boolean"
        }
      }
    },
    "OauthConfig": {
      "description": "OAuth-specific configuration",
      "type": "object",
      "required": [
        "audience",
        "issuer"
      ],
      "properties": {
        "algorithm": {
          "description": "JWT algorithm (e.g., RS256, ES256)",
          "default": "",
          "type": "string"
        },
        "allowed_subjects": {
          "description": "Allowed subjects (user IDs) that can access this resource If not specified, any authenticated subject is allowed",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "audience": {
          "description": "API audience(s) (required for security) - array of audience strings",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "authorize_endpoint": {
          "description": "Authorization endpoint (optional)",
          "default": "",
          "type": "string"
        },
        "issuer": {
          "description": "OAuth issuer URL",
          "type": "string"
        },
        "jwks_uri": {
          "description": "JWKS URI (optional - can be auto-discovered for some providers)",
          "default": "",
          "type": "string"
        },
        "public_key": {
          "description": "Public key in PEM format (optional - alternative to JWKS)",
          "default": "",
          "type": "string"
        },
        "required_scopes": {
          "description": "Required scopes (comma-separated)",
          "default": "",
          "type": "string"
        },
        "token_endpoint": {
          "description": "Token endpoint (optional)",
          "default": "",
          "type": "string"
        },
        "userinfo_endpoint": {
          "description": "User info endpoint (optional)",
          "default": "",
          "type": "string"
        }
      }
    },
    "ProjectConfig": {
      "description": "Project metadata",
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "access_control": {
          "description": "Access control mode for deployment (public, private, org, custom)",
          "default": null,
          "type": [
            "string",
            "null"
          ]
        },
        "allowed_roles": {
          "description": "Allowed roles for organization mode Only users with these roles in the organization can access the app",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "authors": {
          "description": "Project authors",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "default_registry": {
          "description": "Default registry for component references Example: \"ghcr.io/myorg\" or \"docker.io\"",
          "default": null,
          "type": [
            "string",
            "null"
          ]
        },
        "description": {
          "description": "Project description",
          "default": "",
          "type": "string"
        },
        "name": {
          "description": "Project name",
          "type": "string"
        },
        "version": {
          "description": "Project version",
          "default": "0.1.0",
          "type": "string"
        }
      }
    },
    "UpConfig": {
      "description": "Up configuration for development mode",
      "type": "object",
      "required": [
        "profile"
      ],
      "properties": {
        "profile": {
          "description": "Build profile to use for 'ftl up'",
          "type": "string"
        }
      }
    }
  }
}
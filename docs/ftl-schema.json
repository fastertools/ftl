{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "FtlConfig",
  "description": "Root configuration structure for ftl.toml",
  "type": "object",
  "required": ["project"],
  "properties": {
    "project": {
      "description": "Project metadata",
      "$ref": "#/$defs/ProjectConfig"
    },
    "auth": {
      "description": "Authorization configuration",
      "$ref": "#/$defs/AuthConfig",
      "default": {
        "enabled": false,
        "provider": "",
        "issuer": "",
        "audience": ""
      }
    },
    "tools": {
      "description": "Tool definitions",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/ToolConfig"
      },
      "default": {}
    },
    "gateway": {
      "description": "Gateway component configuration",
      "$ref": "#/$defs/GatewayConfig",
      "default": {
        "version": "",
        "authorizer_version": "",
        "validate_arguments": true
      }
    },
    "variables": {
      "description": "Application-level variables",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/ApplicationVariable"
      },
      "default": {}
    }
  },
  "$defs": {
    "ProjectConfig": {
      "description": "Project metadata",
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "description": "Project name (alphanumeric, hyphens, underscores only, must start with letter)",
          "type": "string",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_-]*$"
        },
        "version": {
          "description": "Semantic version (e.g., 0.1.0)",
          "type": "string",
          "default": "0.1.0"
        },
        "description": {
          "description": "Project description",
          "type": "string",
          "default": ""
        },
        "authors": {
          "description": "Project authors",
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        }
      }
    },
    "AuthConfig": {
      "description": "Authorization configuration",
      "type": "object",
      "properties": {
        "enabled": {
          "description": "Enable authorization for this MCP server",
          "type": "boolean",
          "default": false
        },
        "provider": {
          "description": "Authorization provider type",
          "type": "string",
          "default": ""
        },
        "issuer": {
          "description": "OIDC issuer URL",
          "type": "string",
          "default": ""
        },
        "audience": {
          "description": "Expected audience for tokens",
          "type": "string",
          "default": ""
        },
        "oidc": {
          "description": "OIDC-specific configuration",
          "$ref": "#/$defs/OidcConfig"
        }
      }
    },
    "OidcConfig": {
      "description": "OIDC-specific configuration",
      "type": "object",
      "required": ["issuer", "provider_name", "jwks_uri", "authorize_endpoint", "token_endpoint"],
      "properties": {
        "issuer": {
          "description": "OIDC issuer URL",
          "type": "string"
        },
        "audience": {
          "description": "API audience",
          "type": "string",
          "default": ""
        },
        "provider_name": {
          "description": "Provider name (e.g., 'auth0', 'okta')",
          "type": "string"
        },
        "jwks_uri": {
          "description": "JWKS URI for token validation",
          "type": "string"
        },
        "authorize_endpoint": {
          "description": "OAuth authorization endpoint",
          "type": "string"
        },
        "token_endpoint": {
          "description": "OAuth token endpoint",
          "type": "string"
        },
        "userinfo_endpoint": {
          "description": "User info endpoint for retrieving user details",
          "type": "string",
          "default": ""
        },
        "allowed_domains": {
          "description": "Comma-separated list of allowed email domains",
          "type": "string",
          "default": ""
        }
      },
      "additionalProperties": false
    },
    "ToolConfig": {
      "description": "Tool configuration",
      "type": "object",
      "required": ["wasm", "build"],
      "properties": {
        "path": {
          "description": "Path to tool directory (defaults to tool name if not specified)",
          "type": "string"
        },
        "wasm": {
          "description": "Path to the WASM file produced by the build",
          "type": "string"
        },
        "build": {
          "description": "Build configuration",
          "$ref": "#/$defs/BuildConfig"
        },
        "profiles": {
          "description": "Build profiles (optional, for advanced multi-profile builds)",
          "$ref": "#/$defs/BuildProfiles"
        },
        "up": {
          "description": "Up configuration for development mode",
          "$ref": "#/$defs/UpConfig"
        },
        "deploy": {
          "description": "Deployment configuration",
          "$ref": "#/$defs/DeployConfig"
        },
        "allowed_outbound_hosts": {
          "description": "Allowed outbound hosts for the tool",
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "variables": {
          "description": "Tool-specific variables",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "default": {}
        }
      }
    },
    "BuildConfig": {
      "description": "Build configuration for a tool",
      "type": "object",
      "required": ["command"],
      "properties": {
        "command": {
          "description": "Build command to execute",
          "type": "string"
        },
        "watch": {
          "description": "Paths to watch for changes in development mode",
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "env": {
          "description": "Environment variables to set during build",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "default": {}
        }
      }
    },
    "BuildProfiles": {
      "description": "Build profiles for a tool",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/BuildProfile"
      }
    },
    "BuildProfile": {
      "description": "A single build profile",
      "type": "object",
      "required": ["command"],
      "properties": {
        "command": {
          "description": "Build command to execute",
          "type": "string"
        },
        "watch": {
          "description": "Paths to watch for changes in development mode",
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "env": {
          "description": "Environment variables to set during build",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "default": {}
        }
      }
    },
    "UpConfig": {
      "description": "Up configuration for development mode",
      "type": "object",
      "required": ["profile"],
      "properties": {
        "profile": {
          "description": "Build profile to use for 'ftl up'",
          "type": "string"
        }
      }
    },
    "DeployConfig": {
      "description": "Deployment configuration for a tool",
      "type": "object",
      "required": ["profile"],
      "properties": {
        "profile": {
          "description": "Build profile to use for deployment (e.g., \"release\", \"production\")",
          "type": "string"
        },
        "name": {
          "description": "Optional custom name suffix for the deployed tool",
          "type": "string"
        }
      }
    },
    "ApplicationVariable": {
      "description": "Application-level variable configuration",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "default": {
              "description": "Default value for the variable",
              "type": "string"
            }
          },
          "required": ["default"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "required": {
              "description": "Whether the variable is required",
              "type": "boolean",
              "const": true
            }
          },
          "required": ["required"],
          "additionalProperties": false
        }
      ]
    },
    "GatewayConfig": {
      "description": "Gateway component configuration",
      "type": "object",
      "properties": {
        "version": {
          "description": "MCP gateway component version (leave empty for latest)",
          "type": "string",
          "default": ""
        },
        "authorizer_version": {
          "description": "MCP authorizer component version (leave empty for latest)",
          "type": "string",
          "default": ""
        },
        "validate_arguments": {
          "description": "Whether to validate tool arguments",
          "type": "boolean",
          "default": true
        }
      }
    }
  }
}